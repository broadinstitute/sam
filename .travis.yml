jdk:
  - oraclejdk8

language: scala

scala:
  - 2.12.7

sudo: required

env:
  global:
  - secure: R4CtPpPtcAbxTvhTXZXVOP0xtXw6fl7QkN7SPwp8OWsWzY2W1kl8V75P1r+470lrojipiw5LhR0DCk0NvLxtmrZRajw0+qJHm18D8DiAZXWbdp777IQvbZor/GHRy0WiqdcidcuxEuV0uF/pvAdJUx6G+1dyD9/CnZcVOtAFzWaJU9UDEO4rVZygDQkeBPN/CDO/tYGfikVXsws1+4iz2CHXEwat0xBPlYD2uWepvMkzvnNL5J+c2nGOXB1Ge5wySOTLbDAoK6rOgcMGVZxg/8AdMZfv0y9vtGmi5tvvs03rDXHItoC5YEG7ohWfU+2mTpPWF3+wSzDBbdD6PhEO20tS5qjVWYiU8KCqgOHKtb5tNHjuQXZriu3BSo2pgFnA5Q/kdd9j28bxgH5YbNpm3BYRVzGKKTwdL3fVb6wmdXsclgs0HSJCp1gl24zartt0m9kliTbvmMJK1uh4itOr8SX46IRv2jXS25CAIAaZ91tsp06bNI+YpLYZVDIox7qQ3xqAS59sBF9UYjYH1PJ8Q5bdYBPfbfQqAEM+PTBokSo0dA79OEPdx2oatRmYmmXl7AtrLvrgQZBXv61XQGbsEC7/ulYcEjHrNrwPMoFB+ATEc6/HFwwMmpdWDZbTmBTLytoIruMXoishy4ebn1BsZjELe5cxTo8uFpumu7Ow454=
  - secure: EjQd9WAPYeTkFCztlBKU+vEjkk5R4JIbmHuGtUUcvoQpN8FOIgLqEvTKtkTeNXo7aaLvvzUypIqXjjPd4GaTXB3sv0CqCEClsm49a55SzlgE8uthz5/tmXLQOPmEdHGluwlfhvBHreFi9sIEz0R0CGg+C/YAUagDpNC5AMsgo+ntFIpuNaoVlUTAeHmyyaK6IGUx4P3TPyJjmZwlIRSfEEcqo0zTkRxkai3Enr1XnitDzghe0XoFme+rkqHqTA6X2d8E3YPHZd+RV+IjCGTxlfRFk4kYQ9OIVckBWep2h2w1aXC+sPu/kw7RCwIcH6fSR94wuRmanClCnKr81sBLB0gcPB4eN23A0GnDGEHFcSNpdWd7gFEVr6nivXoR4v25Ng5pHVUQY9kprqjXmd8uF/L0MARmtbjBjsZtQknVZVZ9MBICL3mdeKbOCwejbptXN7nQPUO7387v5OHMz8BFbJMqRcjtTIRaNcu3KdtWu+urYwkzalEuYjZ8ZBUm7Fx26nHJevPe7TBxLqShVqVm52HsZS9nfDYavgzi0EayPnMaPVx06DgXQAaHXhqPjrNAuyu5+Y1ZfkwTBS0Wm+36/ADwPIxTmlaWjxRzNaD/CRthVTauuTTdoCHtuzW4jw3dgSBRmt+10FFVVegbW+0uiI1o5AXIdSW0rnWoly9DcjA=
  - secure: Poow3t4dWza2XvLGbBWjy43mgEPDXuhWAwOQyT0ggYX8hsYaPx7byO/xIYdNKDVU3NBkfnueyGt0EavHhUEXFUwpADr/Qg6CqqyQQSY0AZCXsLwEWYuBHfBZxmgAnxw5venWtcY8jXWwavZqRfC/q5tViSq4IIuh/jvZJ1OXJ6OkApZ3p6SYTXJdJ7Qf4sKfoeqKMZ+D0RVnVF+2tywSjUicQpDk1oUZulpe4IPxquZA22NAAFCepXEiQytQ7UE7ze8vqfrADYnsK2TJeUa3EXMBCE2YQ7mXPca2TgN9UtlTikdyRmY2SLi1e2MJfW/0ZMqr+rNyzN5kWMWTGJKqbOCGcTta1Ro61aZh/xmMUv+qq2hA3oGw6EZsFe51xh/pEkzo2TVikxQyWdJHoCQZJ7Cxf+eoIlTbm17YriL1G8cpmy4lAboZSk5DTd/s3Jg0lH21auCE0O5NPQOjg/N1OPQ8GN1kXcy0MCeAnRBaTyEwqlsYaNr5ZIi3uCvblQPcqeW5+4DoEcC9mRoG1cU3ms/4do7eVXSPlzAr1+QsXCTHc6sSEX9b3UdGrDDGk89YvvFyLphOHwdC054bCvGskfc/Eh0A5R4U2oLGqcuBF2Gk9PVpOjiEduYu0KIQT4uoJeRvCpNT/6pbJMc7yGmVdSDmqs5PFBF4gkdtK+Ed6dk=

services:
  - docker

before_install:
  - sh docker/run-opendj.sh start

script:
  - export SBT_OPTS="-J-Xmx3g -Denv.type=test -Ddirectory.url=ldap://localhost:3389 -Ddirectory.password=testtesttest"
  - sbt clean "testOnly -- -n org.broadinstitute.tags.SchemaInit"
  - docker restart opendj
  - sleep 40
  - sbt coverage "testOnly -- -l org.broadinstitute.tags.SchemaInit" coverageReport
  - bash scripts/gen_java_client.sh

after_success:
  - export SBT_OPTS="-J-Xmx3g"
  - sbt coveralls
  - sh docker/run-opendj.sh stop
  - bash scripts/publish-client.sh
